<!DOCTYPE html>
<html lang="en">

<head>
    <title>Kitchen Kompanion</title>
    <link rel="stylesheet" href="styles.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="bootstrap.min.css">

</head>

<body>
    <div class="device">

        <div id="Fridge Inventory" class="tabcontent" style="display:block;">
            <div class="row">
                <div class="col-12">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h1 class="m-0 fw-bold color-1">Inventory</h1>
                        <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#addItemModal">
                            + Add Item
                        </button>
                    </div>
                    <hr class="hr-1">
                    <div id="empty-state" class="text-center py-5" style="display:none;">
                        <p class="text-muted mb-0">No items in your inventory yet. Add one above!</p>
                    </div>
                    <div id="inventoryList" class="d-flex flex-column gap-2">
                    </div>
                </div>
            </div>
        </div>

        <!--Add/change Item Modal-->
        <div class="modal fade" id="addItemModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="addItemModalTitle">Add New Item</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form id="addItemForm">
                            <div class="mb-3">
                                <label for="itemName" class="form-label">Item Name</label>
                                <input type="text" id="itemName" class="form-control" required>
                            </div>
                            <div class="mb-3">
                                <label for="itemCategory" class="form-label">Category</label>
                                <input type="text" id="itemCategory" class="form-control"
                                    placeholder="Dairy, Produce, Meat...">
                            </div>
                            <div class="mb-3">
                                <label for="itemQuantity" class="form-label">Quantity</label>
                                <input type="text" id="itemQuantity" class="form-control"
                                    placeholder="1 gallon, 10 cups...">
                            </div>
                            <div class="mb-3">
                                <label for="itemDate" class="form-label">Expiration Date</label>
                                <input type="date" id="itemDate" class="form-control" required>
                            </div>
                            <button type="submit" class="btn btn-primary w-100" id="addItemSubmitBtn">Add Item</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!--Remove Item Modal-->
        <div class="modal fade" id="deleteItemModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Remove Item</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <p id="deleteMessage">Are you sure you want to remove this item?</p>
                        <p id="deleteExpiration" class="text-muted small mb-0"></p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn w-100 text-center btn-danger"
                            id="confirmDeleteBtn">Remove</button>
                    </div>
                </div>
            </div>
        </div>

        <script>
            const form = document.getElementById('addItemForm');
            const list = document.getElementById('inventoryList');

            let itemToDelete = null;
            let itemToDeleteName = '';
            let itemToDeleteDate = '';

            let itemBeingEdited = null;
            let isEditing = false;

            const addItemModalEl = document.getElementById('addItemModal');

            addItemModalEl.addEventListener('hidden.bs.modal', () => {
                isEditing = false;
                itemBeingEdited = null;

                document.getElementById('addItemModalTitle').textContent = 'Add New Item';
                document.getElementById('addItemSubmitBtn').textContent = 'Add Item';

                form.reset();
            });

            form.addEventListener('submit', (e) => {
                e.preventDefault();

                const name = document.getElementById('itemName').value.trim();
                const category = document.getElementById('itemCategory').value.trim();
                const quantity = document.getElementById('itemQuantity').value.trim();
                const date = document.getElementById('itemDate').value;

                if (!name || !date) return;

                if (isEditing && itemBeingEdited) {
                    itemBeingEdited.dataset.name = name;
                    itemBeingEdited.dataset.date = date;
                    itemBeingEdited.dataset.category = category;
                    itemBeingEdited.dataset.quantity = quantity;

                    const formattedDate = formatMMDDYYYY(date);
                    const daysText = buildDaysText(date);
                    const niceCategory = category || 'Uncategorized';
                    const niceQuantity = quantity || '1';

                    itemBeingEdited.querySelector('.inv-name').textContent = name;
                    itemBeingEdited.querySelector('.inv-meta').innerHTML = `
                    <button class="btn btn-sm btn-primary me-2" onclick="toggleQuantity(this, event)">
                        Quantity
                    </button>
                    <span class="inv-qty d-none">${niceCategory} Â· Quantity: ${niceQuantity}</span>
                    `;
                    itemBeingEdited.querySelector('.inv-days').textContent = daysText;
                    itemBeingEdited.querySelector('.inv-exp').textContent = `Expires ${formattedDate}`;

                    isEditing = false;
                    itemBeingEdited = null;
                    document.getElementById('addItemModalTitle').textContent = 'Add New Item';
                    document.getElementById('addItemSubmitBtn').textContent = 'Add Item';

                } else {
                    const itemDiv = document.createElement('div');
                    itemDiv.className = 'inventory-item';
                    itemDiv.style.height = '80px';

                    itemDiv.dataset.name = name;
                    itemDiv.dataset.date = date;
                    itemDiv.dataset.category = category;
                    itemDiv.dataset.quantity = quantity;

                    const formattedDate = formatMMDDYYYY(date);
                    const daysText = buildDaysText(date);
                    const niceCategory = category || 'Uncategorized';
                    const niceQuantity = quantity || '1';

                    itemDiv.innerHTML = `
                    <div class="inventory-item-content d-flex w-100 h-100 px-3 align-items-center">
                        <div class="flex-grow-1">
                            <div class="fw-semibold inv-name">${name}</div>
                            <div class="text-lightgray small inv-meta d-flex align-items-center">
                                <button class="btn btn-sm btn-primary me-2" onclick="toggleQuantity(this, event)">
                                    Quantity
                                </button>
                                <span class="inv-qty d-none">${niceCategory} Â· Quantity: ${niceQuantity}</span>
                            </div>

                        </div>
                        <div class="text-end me-2">
                            <div class="fw-semibold inv-days">${daysText}</div>
                            <div class="text-lightgray small inv-exp">Expires ${formattedDate}</div>
                        </div>
                    </div>
                    <button class="inventory-delete-btn">&times;</button>
                `;

                    list.appendChild(itemDiv);
                    addSwipeHandlers(itemDiv);

                    const delBtn = itemDiv.querySelector('.inventory-delete-btn');
                    delBtn.addEventListener('click', (ev) => {
                        ev.stopPropagation();
                        itemToDelete = itemDiv;

                        const name = itemDiv.dataset.name || 'this item';
                        const date = itemDiv.dataset.date || '';
                        document.getElementById('deleteMessage').textContent = `Are you sure you want to remove ${name}?`;
                        document.getElementById('deleteExpiration').textContent = date ? buildExpirationText(date) : '';

                        const deleteModalEl = document.getElementById('deleteItemModal');
                        const deleteModal = bootstrap.Modal.getOrCreateInstance(deleteModalEl);
                        deleteModal.show();
                    });

                    itemDiv.addEventListener('click', (ev) => {
                        if (ev.target.closest('.inventory-delete-btn')) return;

                        if (itemDiv._justSwiped) {
                            itemDiv._justSwiped = false;
                            return;
                        }

                        openEditModalFor(itemDiv);
                    });
                }

                form.reset();
                const addModalEl = document.getElementById('addItemModal');
                const addModal = bootstrap.Modal.getOrCreateInstance(addModalEl);
                addModal.hide();
                updateEmptyState();
            });


            document.getElementById('confirmDeleteBtn').addEventListener('click', () => {
                if (itemToDelete) {
                    itemToDelete.remove();
                    updateEmptyState();
                }
                const deleteModalEl = document.getElementById('deleteItemModal');
                const deleteModal = bootstrap.Modal.getInstance(deleteModalEl);
                deleteModal.hide();
            });

            const deleteModalEl = document.getElementById('deleteItemModal');
            deleteModalEl.addEventListener('hide.bs.modal', () => {
                if (itemToDelete && itemToDelete.classList.contains('show-delete')) {
                    itemToDelete.classList.remove('show-delete');
                }
            });

            function buildExpirationText(isoDate) {
                const today = new Date();
                const itemDate = new Date(isoDate);
                const mm = String(itemDate.getMonth() + 1).padStart(2, '0');
                const dd = String(itemDate.getDate()).padStart(2, '0');
                const yyyy = itemDate.getFullYear();
                const formatted = `${mm}/${dd}/${yyyy}`;

                today.setHours(0, 0, 0, 0);
                itemDate.setHours(0, 0, 0, 0);

                if (itemDate < today) {
                    return `Expired on ${formatted}`;
                } else {
                    return `Expiration date: ${formatted}`;
                }
            }

            function updateEmptyState() {
                const list = document.getElementById('inventoryList');
                const emptyState = document.getElementById('empty-state');

                if (list.children.length === 0) {
                    emptyState.style.display = 'block';
                } else {
                    emptyState.style.display = 'none';
                }
            }

            function formatMMDDYYYY(isoDate) {
                const [year, month, day] = isoDate.split("-");
                return `${month}/${day}/${year}`;
            }

            function buildDaysText(isoDate) {
                const today = new Date();
                const itemDate = new Date(isoDate);

                today.setHours(0, 0, 0, 0);
                itemDate.setHours(0, 0, 0, 0);

                const msPerDay = 1000 * 60 * 60 * 24;
                const diff = itemDate - today;
                const days = Math.round(diff / msPerDay);

                if (days < 0) {
                    return 'Expired';
                } else if (days === 0) {
                    return 'Use by End of Today';
                } else if (days === 1) {
                    return 'Use within 1 day';
                } else {
                    return `Use within ${days} days`;
                }
            }


            function openTab(tabName, element, color) {
                var i, tabcontent, tablinks;
                tabcontent = document.getElementsByClassName("tabcontent");
                for (i = 0; i < tabcontent.length; i++) {
                    tabcontent[i].style.display = "none";
                }

                tablinks = document.getElementsByClassName("tablink");
                for (i = 0; i < tablinks.length; i++) {
                    tablinks[i].style.backgroundColor = "";
                }

                document.getElementById(tabName).style.display = "block";
                element.style.backgroundColor = color;
            }

            function addSwipeHandlers(item) {
                let startX = 0;
                let currentX = 0;
                let swiped = false;
                let isPointerDown = false;

                item._justSwiped = false;

                item.addEventListener('touchstart', (e) => {
                    startX = e.touches[0].clientX;
                    swiped = false;
                    item._justSwiped = false;
                });

                item.addEventListener('touchmove', (e) => {
                    currentX = e.touches[0].clientX;
                    const diff = currentX - startX;

                    if (diff < -30 && !swiped) {
                        item.classList.add('show-delete');
                        swiped = true;
                        item._justSwiped = true;
                    }
                    if (diff > 30 && item.classList.contains('show-delete')) {
                        item.classList.remove('show-delete');
                        item._justSwiped = true;
                    }
                });

                item.addEventListener('mousedown', (e) => {
                    startX = e.clientX;
                    swiped = false;
                    isPointerDown = true;
                    item._justSwiped = false;
                });

                item.addEventListener('mousemove', (e) => {
                    if (!isPointerDown) return;
                    currentX = e.clientX;
                    const diff = currentX - startX;

                    if (diff < -30 && !swiped) {
                        item.classList.add('show-delete');
                        swiped = true;
                        item._justSwiped = true;
                    }
                    if (diff > 30 && item.classList.contains('show-delete')) {
                        item.classList.remove('show-delete');
                        item._justSwiped = true;
                    }
                });

                item.addEventListener('mouseup', () => {
                    isPointerDown = false;
                });

                item.addEventListener('mouseleave', () => {
                    isPointerDown = false;
                });
            }


            function openEditModalFor(itemDiv) {
                isEditing = true;
                itemBeingEdited = itemDiv;

                document.getElementById('itemName').value = itemDiv.dataset.name || '';
                document.getElementById('itemDate').value = itemDiv.dataset.date || '';
                document.getElementById('itemCategory').value = itemDiv.dataset.category || '';
                document.getElementById('itemQuantity').value = itemDiv.dataset.quantity || '';

                document.getElementById('addItemModalTitle').textContent = 'Edit Item';
                document.getElementById('addItemSubmitBtn').textContent = 'Update Item';

                const addModal = new bootstrap.Modal(document.getElementById('addItemModal'));
                addModal.show();
            }
            document.getElementById("defaultOpen").click();
            document.addEventListener('DOMContentLoaded', updateEmptyState);
        </script>

        <div id="Shopping List" class="tabcontent">
            <h1>Shopping List</h1>
            <div class="shopping-form-container mb-4">
                <div class="card shopping-card">
                    <div class="card-body">
                        <h5 class="card-title mb-3">Add New Item</h5>
                        <form id="shopping-form" class="row g-3">
                            <div class="col-12 col-md-6">
                                <label for="item-name" class="form-label">Item Name</label>
                                <input type="text" class="form-control" id="item-name" placeholder="Enter item name"
                                    required>
                            </div>
                            <div class="col-12 col-md-3">
                                <label for="item-category" class="form-label">Category</label>
                                <select class="form-select" id="item-category" required>
                                    <option value="">Select category</option>
                                    <option value="Fruits">Fruits</option>
                                    <option value="Vegetables">Vegetables</option>
                                    <option value="Dairy">Dairy</option>
                                    <option value="Meat">Meat</option>
                                    <option value="Beverages">Beverages</option>
                                    <option value="Snacks">Snacks</option>
                                    <option value="Grains">Grains</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                            <div class="col-12 col-md-3">
                                <label for="item-owner" class="form-label">Assign To</label>
                                <select class="form-select" id="item-owner" required>
                                    <option value="">Select roommate</option>
                                    <option value="Everyone">Everyone</option>
                                    <option value="Jinan">Jinan</option>
                                    <option value="Shravan">Shravan</option>
                                    <option value="Dain">Dain</option>
                                    <option value="Abhi">Abhi</option>
                                </select>
                            </div>
                            <div class="col-12">
                                <button type="submit" class="btn btn-primary w-100">Add Item</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Filter and Sort Controls -->
            <div class="filter-sort-container mb-3">
                <div class="row g-2">
                    <div class="col-6 col-md-4">
                        <label for="filter-category" class="form-label small">Filter by Category</label>
                        <select class="form-select form-select-sm" id="filter-category">
                            <option value="all">All Categories</option>
                            <option value="Fruits">Fruits</option>
                            <option value="Vegetables">Vegetables</option>
                            <option value="Dairy">Dairy</option>
                            <option value="Meat">Meat</option>
                            <option value="Beverages">Beverages</option>
                            <option value="Snacks">Snacks</option>
                            <option value="Grains">Grains</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div class="col-6 col-md-4">
                        <label for="filter-owner" class="form-label small">Filter by Owner</label>
                        <select class="form-select form-select-sm" id="filter-owner">
                            <option value="all">All Owners</option>
                            <option value="Everyone">Everyone</option>
                            <option value="Jinan">Jinan</option>
                            <option value="Shravan">Shravan</option>
                            <option value="Dain">Dain</option>
                            <option value="Abhi">Abhi</option>
                        </select>
                    </div>
                    <div class="col-12 col-md-4">
                        <label for="sort-option" class="form-label small">Sort By</label>
                        <select class="form-select form-select-sm" id="sort-option">
                            <option value="name">Name (A-Z)</option>
                            <option value="category">Category</option>
                            <option value="owner">Owner</option>
                            <option value="status">Status</option>
                        </select>
                    </div>
                </div>
            </div>

            <div id="shopping-list-container">
                <ul id="shopping-list" class="list-group">
                </ul>
            </div>

            <div id="empty-state" class="text-center py-5" style="display: none;">
                <p class="text-muted">No items in your shopping list. Add one above!</p>
            </div>
        </div>

        <div id="Recipes" class="tabcontent">
            <h1>Recipes</h1>

            <div class="card recipe-card mb-3">
                <div class="card-body">
                    <h5 class="card-title">Add Recipe</h5>
                    <form id="recipe-form" class="row g-2">
                        <div class="col-12">
                            <label class="form-label">Recipe Name</label>
                            <input type="text" class="form-control" id="recipe-name" required>
                        </div>
                        <div class="col-12">
                            <label class="form-label">Ingredients</label>
                            <input type="text" class="form-control" id="recipe-ingredients"
                                placeholder="e.g., Chicken, Rice, Spices" required>
                        </div>
                        <div class="col-12">
                            <button class="btn btn-primary w-100" type="submit">Save Recipe</button>
                        </div>
                    </form>
                </div>
            </div>

            <div id="recipe-list"></div>

            <div id="recipe-empty" class="text-center py-5" style="display:none;">
                <p class="text-muted">No saved recipes yet.</p>
            </div>
        </div>

        <div class="tab-navigation">
            <button class="tablink" onclick="openTab('Fridge Inventory', this, '#2978A0')">
                <div class="tab-icon">ðŸ‘¤</div>
                <div class="tab-label">Fridge Inventory</div>
            </button>
            <button class="tablink" onclick="openTab('Shopping List', this, '#2978A0')">
                <div class="tab-icon">ðŸ’¡</div>
                <div class="tab-label">Shopping List</div>
            </button>
            <button class="tablink" onclick="openTab('Recipes', this, '#2978A0')">
                <div class="tab-icon">âœ…</div>
                <div class="tab-label">Recipes</div>
            </button>
        </div>
    </div>

    <script src="bootstrap.bundle.min.js"></script>
    <script>
        let shoppingItems = [];
        let itemIdCounter = 0;

        let fridgeItems = [
            { id: 1, name: "Milk", quantity: "1 Gallon", category: "Dairy", date: "2025-12-15" },
            { id: 2, name: "Eggs", quantity: "8 Remaining", category: "Dairy", date: "2025-12-20" },
            { id: 3, name: "Lettuce", quantity: "2.5 Heads", category: "Produce", date: "2025-11-08" },
            { id: 4, name: "Leftover Pasta", quantity: "1 Container", category: "Leftovers", date: "2025-11-01" }
        ];


        let recipes = [];

        function openTab(tabName, element, color) {
            var i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tabcontent");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }

            tablinks = document.getElementsByClassName("tablink");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].classList.remove("active");
                tablinks[i].style.backgroundColor = "";
            }

            document.getElementById(tabName).style.display = "block";
            element.classList.add("active");
            element.style.backgroundColor = color;

            if (tabName === "Fridge Inventory") renderFridge();
            if (tabName === "Recipes") renderRecipes();
        }

        window.addEventListener('DOMContentLoaded', function () {
            const shoppingListTab = document.querySelectorAll('.tablink')[1];
            if (shoppingListTab) {
                openTab('Shopping List', shoppingListTab, '#2978A0');
            }
        });

        function renderFridge() {
            const body = document.getElementById("fridge-body");
            const empty = document.getElementById("fridge-empty");

            body.innerHTML = "";

            if (fridgeItems.length === 0) {
                empty.style.display = "block";
                return;
            } else {
                empty.style.display = "none";
            }

            fridgeItems.forEach(item => {
                let row = document.createElement("tr");
                row.innerHTML = `
                    <td><strong>${item.name}</strong></td>
                    <td><span class="badge bg-info text-dark">${item.status}</span></td>
                    <td>
                        <button class="btn btn-primary btn-sm" onclick="alert('${item.name}: ${item.quantity}')">
                            Quantity
                        </button>
                    </td>
                `;
                body.appendChild(row);
            });
        }

        document.getElementById("recipe-form").addEventListener("submit", function (e) {
            e.preventDefault();
            const name = document.getElementById("recipe-name").value.trim();
            const ing = document.getElementById("recipe-ingredients").value.trim();
            if (name && ing) {
                recipes.push({ id: Date.now(), name, ing });
                this.reset();
                renderRecipes();
            }
        });

        function deleteRecipe(id) {
            recipes = recipes.filter(r => r.id !== id);
            renderRecipes();
        }

        function renderRecipes() {
            const list = document.getElementById("recipe-list");
            const empty = document.getElementById("recipe-empty");

            list.innerHTML = "";
            if (recipes.length === 0) {
                empty.style.display = "block";
                return;
            }
            empty.style.display = "none";

            recipes.forEach(r => {
                let card = document.createElement("div");
                card.className = "recipe-card card mb-2";
                card.innerHTML = `
                    <div class="card-body d-flex justify-content-between align-items-center">
                        <div>
                            <h6>${r.name}</h6>
                            <small class="text-muted">${r.ing}</small>
                        </div>
                        <button class="btn btn-outline-danger btn-sm" onclick="deleteRecipe(${r.id})">Ã—</button>
                    </div>
                `;
                list.appendChild(card);
            });
        }

        function addShoppingItem(name, category, owner) {
            const item = {
                id: itemIdCounter++,
                name: name,
                category: category,
                owner: owner,
                purchased: false,
                dateAdded: new Date()
            };
            shoppingItems.push(item);
            saveToLocalStorage();
            renderShoppingList();
        }

        function togglePurchased(itemId) {
            const item = shoppingItems.find(i => i.id === itemId);
            if (item) {
                item.purchased = !item.purchased;
                saveToLocalStorage();
                renderShoppingList();
            }
        }

        function deleteItem(itemId) {
            shoppingItems = shoppingItems.filter(i => i.id !== itemId);
            saveToLocalStorage();
            renderShoppingList();
        }

        function renderShoppingList() {
            const listContainer = document.getElementById('shopping-list');
            const emptyState = document.getElementById('empty-state');

            const categoryFilter = document.getElementById('filter-category').value;
            const ownerFilter = document.getElementById('filter-owner').value;
            const sortOption = document.getElementById('sort-option').value;

            let filteredItems = shoppingItems.filter(item => {
                const categoryMatch = categoryFilter === 'all' || item.category === categoryFilter;
                const ownerMatch = ownerFilter === 'all' || item.owner === ownerFilter;
                return categoryMatch && ownerMatch;
            });

            filteredItems.sort((a, b) => {
                switch (sortOption) {
                    case 'name':
                        return a.name.localeCompare(b.name);
                    case 'category':
                        return a.category.localeCompare(b.category);
                    case 'owner':
                        return a.owner.localeCompare(b.owner);
                    case 'status':
                        return a.purchased === b.purchased ? 0 : a.purchased ? 1 : -1;
                    default:
                        return 0;
                }
            });

            listContainer.innerHTML = '';

            if (filteredItems.length === 0) {
                emptyState.style.display = 'block';
                listContainer.style.display = 'none';
            } else {
                emptyState.style.display = 'none';
                listContainer.style.display = 'block';

                filteredItems.forEach(item => {
                    const li = document.createElement('li');
                    li.className = `list-group-item shopping-item ${item.purchased ? 'purchased' : ''}`;
                    li.setAttribute('data-id', item.id);

                    li.innerHTML = `
                        <div class="d-flex align-items-center">
                            <div class="form-check me-3">
                                <input class="form-check-input" type="checkbox" ${item.purchased ? 'checked' : ''} 
                                       onchange="togglePurchased(${item.id})" id="check-${item.id}">
                            </div>
                            <div class="flex-grow-1">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h6 class="mb-1 ${item.purchased ? 'text-decoration-line-through text-muted' : ''}">${item.name}</h6>
                                        <small class="text-muted">
                                            <span class="badge bg-secondary me-1">${item.category}</span>
                                            <span class="badge bg-info">${item.owner}</span>
                                        </small>
                                    </div>
                                    <button class="btn btn-sm btn-outline-danger ms-2" onclick="deleteItem(${item.id})">
                                        <span>Ã—</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                    listContainer.appendChild(li);
                });
            }
        }

        document.getElementById('shopping-form').addEventListener('submit', function (e) {
            e.preventDefault();
            const name = document.getElementById('item-name').value.trim();
            const category = document.getElementById('item-category').value;
            const owner = document.getElementById('item-owner').value;

            if (name && category && owner) {
                addShoppingItem(name, category, owner);
                this.reset();
            }
        });

        document.getElementById('filter-category').addEventListener('change', renderShoppingList);
        document.getElementById('filter-owner').addEventListener('change', renderShoppingList);
        document.getElementById('sort-option').addEventListener('change', renderShoppingList);

        function toggleQuantity(btn, event) {
            event.stopPropagation();
            const span = btn.parentElement.querySelector('.inv-qty');
            span.classList.toggle('d-none');
        }


        function saveToLocalStorage() {
            localStorage.setItem('shoppingItems', JSON.stringify(shoppingItems));
            localStorage.setItem('itemIdCounter', itemIdCounter.toString());
        }

        function loadFromLocalStorage() {
            const saved = localStorage.getItem('shoppingItems');
            const savedCounter = localStorage.getItem('itemIdCounter');
            if (saved) {
                shoppingItems = JSON.parse(saved);
                itemIdCounter = savedCounter ? parseInt(savedCounter) : shoppingItems.length;
            }
            renderShoppingList();
        }

        window.addEventListener('DOMContentLoaded', function () {
            loadFromLocalStorage();
        });

        window.addEventListener("DOMContentLoaded", function () {
        fridgeItems.forEach(item => {
            const itemDiv = document.createElement('div');
            itemDiv.className = 'inventory-item';
            itemDiv.style.height = '80px';

            itemDiv.dataset.name = item.name;
            itemDiv.dataset.date = item.date;
            itemDiv.dataset.category = item.category;
            itemDiv.dataset.quantity = item.quantity;

            const formattedDate = formatMMDDYYYY(item.date);
            const daysText = buildDaysText(item.date);
            const niceCategory = item.category || 'Uncategorized';
            const niceQuantity = item.quantity || '1';

            itemDiv.innerHTML = `
                <div class="inventory-item-content d-flex w-100 h-100 px-3 align-items-center">
                    <div class="flex-grow-1">
                        <div class="fw-semibold inv-name">${item.name}</div>
                        <div class="text-lightgray small inv-meta d-flex align-items-center">
                            <button class="btn btn-sm btn-primary me-2" onclick="toggleQuantity(this, event)">
                                Quantity
                            </button>
                            <span class="inv-qty d-none">${niceCategory} Â· Quantity: ${niceQuantity}</span>
                        </div>
                    </div>
                    <div class="text-end me-2">
                        <div class="fw-semibold inv-days">${daysText}</div>
                        <div class="text-lightgray small inv-exp">Expires ${formattedDate}</div>
                    </div>
                </div>
                <button class="inventory-delete-btn">&times;</button>
            `;

            list.appendChild(itemDiv);
            addSwipeHandlers(itemDiv);
        });

        updateEmptyState();
    });
    </script>
</body>

</html>